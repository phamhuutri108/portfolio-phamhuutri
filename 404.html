<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pham Huu Tri's Portfolio</title>

    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://www.youtube.com">


    <link rel="stylesheet" href="/style.css?v=5.0">
    <link rel="icon" type="image/jpeg" href="https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/home/one-buddha-is-not-enough.JPG?v=2">

    <meta name="description" content="A human being.">
    <meta name="author" content="Pham Huu Tri">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://phamhuutri.com/">
    <meta property="og:title" content="Pham Huu Tri's Portfolio">
    <meta property="og:description" content="A human being.">

    <meta property="og:image" content="https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/home/cover-meta.png?v=2">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Pham Huu Tri's Portfolio">
    <meta name="twitter:description" content="A human being.">
    <meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/home/cover-meta.png?v=2">
</head>
<body>

<div class="wrapper">
    <aside class="sidebar">

        <div class="lang-switch">
    <span class="lang-btn active" onclick="setLanguage('en')" id="btn-en">EN</span>
    <span class="separator">-</span>
    <span class="lang-btn" onclick="setLanguage('vi')" id="btn-vi">VI</span>
</div>
<div class="site-logo">
    </div>

        <div class="site-logo">
            <a href="javascript:void(0)" onclick="showPage('home')">
                <img src="https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/home/tri-avatar-b%26w.png?v=2" alt="Pham Huu Tri">
            </a>
        </div>

        <ul class="main-menu">
    <li>
        <a href="javascript:void(0)" onclick="showPage('home')" id="link-home" class="active-link">
            <span class="content-en">Home</span>
            <span class="content-vi">Trang Chủ</span>
        </a>
    </li>
    <li>
        <a href="javascript:void(0)" onclick="showPage('about')" id="link-about">
            <span class="content-en">About</span>
            <span class="content-vi">Về Tôi</span>
        </a>
    </li>
    <li>
        <a href="javascript:void(0)" onclick="showPage('contact')" id="link-contact">
            <span class="content-en">Contact</span>
            <span class="content-vi">Liên Hệ</span>
        </a>
    </li>
</ul>

        <div class="category-group" id="group-short-films">
        <h4>
            <a href="javascript:void(0)" onclick="showPage('cat-short-films', 'group-short-films')" id="link-cat-short-films">
                <span class="content-en">Short Films</span>
                <span class="content-vi">Phim Ngắn</span>
            </a>
        </h4>
        <ul class="category-list" id="sidebar-short-films-list"></ul>
    </div>

    <div class="category-group" id="group-commercials">
        <h4>
            <a href="javascript:void(0)" onclick="showPage('cat-commercials', 'group-commercials')" id="link-cat-commercials">
                <span class="content-en">Commercials</span>
                <span class="content-vi">Quảng Cáo</span>
            </a>
        </h4>
        <ul class="category-list" id="sidebar-commercials-list"></ul>
    </div>

    <div class="category-group" id="group-others">
        <h4>
            <a href="javascript:void(0)" onclick="showPage('cat-others', 'group-others')" id="link-cat-others">
                <span class="content-en">Others</span>
                <span class="content-vi">Các Dự Án Khác</span>
            </a>
        </h4>
        <ul class="category-list" id="sidebar-others-list"></ul>
    </div>

    <div class="category-group" id="group-writings">
        <h4>
            <a href="javascript:void(0)" onclick="showPage('cat-writings', 'group-writings')" id="link-cat-writings">
                <span class="content-en">Writings</span>
                <span class="content-vi">Viết</span>
            </a>
        </h4>
        <ul class="category-list" id="sidebar-writings-list"></ul>
    </div>

        <div class="copyright">
            <p>&copy; 2026 Pham Huu Tri.</p>
        </div>
    </aside>

    <main class="content">
        
        <div id="home" class="page-section active-section">
            <img src="https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/home/one-buddha-is-not-enough.JPG?v=2" 
                 alt="Home Art" 
                 class="home-center-img">
            
            <div id="play-hint">
                <span class="content-en">Click to play</span>
                <span class="content-vi">Bấm để phát</span>
            </div>

            <div id="pause-hint">
                <span class="content-en">Click to pause</span>
                <span class="content-vi">Bấm để dừng</span>
            </div>
            
            <a id="music-credit" href="https://www.shazam.com/song/1782208078/angells" target="_blank">
                ♫ Plínio Fabrício - Angells ♫
            </a>
        </div>

        <div id="not-found" class="page-section">
        <h2 style="font-size: 40px; margin-bottom: 20px;">404</h2>
        <p style="font-size: 16px; margin-bottom: 30px;">
            <span class="content-en">Page not found.</span>
            <span class="content-vi">Trang này không tồn tại.</span>
        </p>
        <a href="javascript:void(0)" onclick="showPage('home')" 
           style="border-bottom: 1px solid #000; padding-bottom: 2px; font-weight: bold;">
            <span class="content-en">Go Back Home</span>
            <span class="content-vi">Về Trang Chủ</span>
        </a>
    </div>

        <div id="about" class="page-section">
    <h2 class="page-title">
        <span class="content-en">About</span>
        <span class="content-vi">Về tôi</span>
    </h2>
    
    <div class="about-text">
        <p>
            <span class="content-vi">
                Xin chào, tôi là <b>Phạm Hữu Trí</b>.<br>
                Hiện tại, tôi đang theo đuổi con đường làm phim độc lập và là một freelancer toàn thời gian. Đôi khi, tôi viết.
            </span>
            <span class="content-en">
                Hello, I am <b>Pham Huu Tri</b>.<br>
                Currently, I am pursuing independent filmmaking and working as a full-time freelancer. Sometimes, I write.
            </span>
        </p>

        <h3 style="margin-top: 40px;">
            <span class="content-vi">Tuyên ngôn</span>
            <span class="content-en">Artist Statement</span>
        </h3>

        <p style="font-style: italic;">"A human being."</p>

        <p>
            <span class="content-vi">
                Thực hành nghệ thuật với tôi là hành trình khảo sát tính nhân bản.
                Mỗi khung hình, mỗi dòng chữ đều là một nỗ lực để thấu hiểu việc làm người.
            </span>
            <span class="content-en">
                To me, artistic practice is a journey of examining humanity.
                Every frame, every line is an effort to understand what it means to be human.
            </span>
        </p>

        <h3 style="margin-top: 40px;">
            <span class="content-vi">Học vấn</span>
            <span class="content-en">Education</span>
        </h3>
        <p>
            <span class="content-vi"> <b>Đại học Văn Lang, TP. HCM</b> (2021 - 2026)<br>
            </span>

            <span class="content-en"> <b>Van Lang University, Vietnam</b> (2021 - 2026)<br>
            </span>
            <span class="content-vi" style="font-size: 11px; color: #666;">
                Đạo diễn Điện ảnh & Truyền hình
            </span>
            <span class="content-en" style="font-size: 11px; color: #666;">
                Bachelor of Arts - Film and Television Directing
            </span>
        </p>

        <h3 style="margin-top: 40px;">
            <span class="content-vi">Quá trình làm phim - Giải thưởng</span>
            <span class="content-en">Filmography - Awards</span>
        </h3>
        
        <ul style="list-style: none; padding-left: 0; font-size: 12px;">
    
    <li style="margin-bottom: 5px;">
        2024 - <i>
            <span class="content-vi">Nghiệp</span>
            <span class="content-en">Karma</span>
        </i>
        <span class="content-vi">(Phim ngắn): <b>Cánh diều bạc</b>, Hội điện ảnh Việt Nam</span>
        <span class="content-en">(Short fiction): <b>Silver Prize</b>, Golden Kite Awards, Vietnam Cinema Association</span>
    </li>

    <li style="margin-bottom: 5px;">
        2023 - <i>
            <span class="content-vi">"Con Ma" Muốn Sống</span>
            <span class="content-en">"The Ghost" Wants to Live</span>
        </i>
        <span class="content-vi">(Phim tài liệu ngắn): <b>Giải ba</b>, Liên hoan phim ngắn TP. HCM</span>
        <span class="content-en">(Short documentary): <b>Third Prize</b>, HCMC Short Film Festival</span>
    </li>

    <li style="margin-bottom: 5px;">
        2022 - <i>
            <span class="content-vi">"Con Ma" Muốn Sống</span>
            <span class="content-en">"The Ghost" Wants to Live</span>
        </i> 
        <span class="content-vi">(Phim tài liệu ngắn): <b>Quỹ sáng tác trẻ</b>, Hội điện ảnh TP. HCM</span>
        <span class="content-en">(Short documentary): <b>Young Creativity Fund</b>, HCMC Cinema Association</span>
    </li>

    <li style="margin-bottom: 5px;">
        2020 - <i>
            <span class="content-vi">Khi Chúng Ta Được Sống</span>
            <span class="content-en">Alive</span>
        </i>
        <span class="content-vi">(Phim ngắn): <b>Phim xuất sắc nhất</b>, The Original Project, Hà Nội</span>
        <span class="content-en">(Short fiction): <b>Best Short Film</b>, The Original Project, Hanoi</span>
    </li>

    <li style="margin-bottom: 5px;">
        2020 - <i>
            <span class="content-vi">Khi Thành Phố Lớn</span>
            <span class="content-en">When My City Grows</span>
        </i>
        <span class="content-vi">(Phim tài liệu ngắn): <b>Giải nhì</b>, Le Filmmaking Camp, Quảng Trị - Đại sứ quán Mỹ tài trợ</span>
        <span class="content-en">(Short documentary): <b>Second Prize</b>, Le Filmmaking Camp, Quang Tri - Sponsored by the U.S. Embassy</span>
    </li>

</ul>

        <div id="resume-holder" style="text-align: center; margin-top: 60px; height: 50px;">
            <a href="https://drive.google.com/file/d/16exeCisXqDe9dqmPtJ8lGSgUCP4F9pD1/view?usp=sharing" target="_blank" id="wandering-resume">Resume</a>
        </div>
    </div>
</div>

        <div id="contact" class="page-section">
    <h2 class="page-title">
        <span class="content-en">Contact</span>
        <span class="content-vi">Liên hệ</span>
    </h2>
    
    <div class="about-text">
        <p>
            <b>
                <span class="content-en">Phone:</span>
                <span class="content-vi">Điện thoại:</span>
            </b> 
            <a href="tel:+84865953041" style="color: #111;">(+84) 865 953 041</a>
        </p>
        
        <p>
            <b>Email:</b> 
            <a href="mailto:contact@phamhuutri.com" style="color: #111;">contact@phamhuutri.com</a>
        </p>
        
        <p>
            <b>Instagram:</b> 
            <a href="https://www.instagram.com/phamhuutri.es" target="_blank">@phamhuutri.es</a>
        </p>
        
        <p>
            <b>Facebook:</b> 
            <a href="https://www.facebook.com/phamhuutri108/" target="_blank">Phạm Hữu Trí</a>
        </p>

        <div class="contact-image-wrapper">
            <img src="https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/contact/contact-image.jpg?v=2"
                 alt="Contact Image"
                 id="musical-image">

            <div id="contact-play-hint">
                <span class="content-en">Click to play</span>
                <span class="content-vi">Bấm để phát</span>
            </div>

            <div id="contact-pause-hint">
                <span class="content-en">Click to pause</span>
                <span class="content-vi">Bấm để dừng</span>
            </div>

            <a id="contact-music-credit" href="https://youtu.be/dda4avWrohY" target="_blank">
                ♫ Tùng - Để Leo Một Ngọn Núi ♫
            </a>
        </div>

        <audio id="contact-audio">
            <source src="https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/contact/Tung-De-Leo-Mot-Ngon-Nui.mp3?v=2" type="audio/mpeg">
        </audio>
    </div>
</div>

        <div id="cat-short-films" class="page-section">
    <h2 class="page-title">
        <span class="content-en">Short Films</span>
        <span class="content-vi">Phim ngắn</span>
    </h2>
    
    <div class="about-text">
        <p>
            <span class="content-en">2020 - present.</span>
            <span class="content-vi">2020 - hiện tại.</span>
        </p>
    </div>

    <div class="gallery-grid" id="grid-short-films" style="margin-top:30px;">

    </div>

</div>

        <div id="cat-commercials" class="page-section">
    <h2 class="page-title">
        <span class="content-en">Commercials</span>
        <span class="content-vi">Quảng cáo</span>
    </h2>
    
    <div class="about-text">
        <p>
            <span class="content-en">2024 - present.</span>
            <span class="content-vi">2024 - hiện tại.</span>
        </p>
    </div>

    <div class="gallery-grid" id="grid-commercials" style="margin-top:30px;">


    </div>
</div>


    <div id="cat-others" class="page-section">
            <h2 class="page-title">
                <span class="content-en">Others</span>
                <span class="content-vi">Các dự án khác</span>
            </h2>
            
            <div class="about-text">
                <p>
                    <span class="content-en">Other projects where I worked on different roles.</span>
                    <span class="content-vi">Các dự án khác nơi tôi làm với vai trò khác.</span>
                </p>
            </div>

            <div class="gallery-grid" id="grid-others" style="margin-top:30px;">

            </div>
        </div>








        <div id="cat-writings" class="page-section">
    <div class="writings-top-area">
        
        <div class="writing-control-wrapper">
            <h2 class="page-title blink-title" id="writing-main-title" onclick="toggleWritingMusic()">
                <span class="content-en">Writings</span>
                <span class="content-vi">Viết</span>
            </h2>

            <div id="writing-hint" class="writing-hint-text">
                <span class="content-en">Click to open</span>
                <span class="content-vi">Bấm để mở</span>
            </div>

            <div id="writing-player" class="writing-player-panel">
                <div class="player-compact-view">
                    <div class="track-info">
                        <span id="wp-song-title" class="wp-title">Select Album</span>
                        <span id="wp-artist-name" class="wp-artist">Lo-fi / Ambient</span>
                    </div>

                    <div class="track-controls">
                        <button onclick="wpPrev()"><svg viewBox="0 0 24 24"><path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/></svg></button>
                        <button onclick="wpTogglePlay()" id="wp-play-btn"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></button>
                        <button onclick="wpNext()"><svg viewBox="0 0 24 24"><path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/></svg></button>
                        <button onclick="wpToggleExpand()" class="expand-btn" id="wp-expand-btn">
                        <svg viewBox="0 0 24 24">
                            <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
                        </svg>
                    </button>
                    </div>
                </div>

                <div class="player-playlist-view" id="wp-playlist">
                    </div>
            </div>
        </div>

        <div id="writings-list-container"></div>
    </div>

    <div id="writings-detail-view" style="display: none;">


        <div id="writing-tools-wrapper">

    <div class="desktop-text-tools">
        <button class="dt-btn" onclick="adjustWritingSize(1)" title="Tăng cỡ chữ">
            <span class="font-georgia">A<sup style="font-size: 11px;">+</sup></span>
        </button>
        <button class="dt-btn" onclick="adjustWritingSize(-1)" title="Giảm cỡ chữ">
            <span class="font-georgia">A<sup style="font-size: 11px;">-</sup></span>
        </button>
    </div>

    <div class="mobile-text-tools" id="mobile-text-tools">
        <button class="mt-toggle-btn" onclick="toggleMobileMenu()">
            <span style="font-family: 'Georgia', serif; font-size: 18px; font-weight: 700;">A</span>
            <span style="font-family: 'Georgia', serif; font-size: 13px; font-weight: 400; margin-left: 2px;">A</span>
        </button>

        <div class="mt-dropdown">
            <button class="mt-action-btn" onclick="adjustWritingSize(1)">
                <span style="font-family: sans-serif; font-size: 18px; font-weight: 300;">+</span>
            </button>
            <button class="mt-action-btn" onclick="adjustWritingSize(-1)">
                <span style="font-family: sans-serif; font-size: 22px; font-weight: 300;">-</span>
            </button>
        </div>
    </div>

</div>




        <div style="margin-bottom: 20px;">
            <a href="javascript:void(0)" onclick="closeWritingDetail()" 
               style="font-size: 26px; text-decoration: none; color: #999; transition: all 0.2s; display: inline-block;"
               title="Back / Quay lại">
                &larr;
            </a>
        </div>
        <h2 class="page-title" id="detail-title" style="text-align: left;"></h2>
        <p style="font-size:13px; color:#666; margin-bottom:30px; font-style: italic; text-align: left;" id="detail-meta"></p>
        <div class="essay-content" id="detail-content" style="max-width: 100%; text-align: justify;"></div>
        <div style="height: 100px;"></div>
    </div>






</div>

<audio id="writing-audio-source"></audio>




<script>
    /* --- HỆ THỐNG TỰ ĐỘNG HOÁ (OPTIMIZED: LAZY RENDERING) --- */

    // 1. CẤU HÌNH ĐƯỜNG DẪN TĨNH
    const urlMapping = {
        'home': '/',
        'about': '/about',
        'contact': '/contact',
        'cat-short-films': '/short-films',
        'cat-commercials': '/commercials',
        'cat-others': '/others',
        'cat-writings': '/writings'
    };

    // 2. HÀM TÌM DỮ LIỆU DỰ ÁN (Helper mới)
    // Giúp tìm thông tin dự án từ ID mà không cần loop nhiều lần
    function getProjectData(id) {
        if (typeof filmsData !== 'undefined' && filmsData[id]) return filmsData[id];
        if (typeof commercialData !== 'undefined' && commercialData[id]) return commercialData[id];
        if (typeof othersData !== 'undefined' && othersData[id]) return othersData[id];
        return null;
    }

    // 3. HÀM RENDER NỘI DUNG CHI TIẾT (ĐÃ NÂNG CẤP: CREW + BTS)
    function renderSectionContent(id) {
        if (document.getElementById(id)) return;

        const item = getProjectData(id);
        if (!item) return;

        const contentContainer = document.querySelector('.content');
        const section = document.createElement('div');
        section.id = id;
        section.className = 'page-section';

        // 1. Tạo nội dung chính (Text & Video)
        let htmlContent = `
            <h2 class="page-title">
                <span class="content-en">${item.title.en}</span>
                <span class="content-vi">${item.title.vi}</span>
            </h2>
            <div class="about-text">
                <div class="content-vi">${item.vi}</div>
                <div class="content-en">${item.en}</div>
            </div>
        `;

        // 2. Tự động sinh Crew Slider (nếu có)
        if (item.crewData && item.crewData.length > 0) {
            // htmlContent += `<h3 style="margin-top: 40px;"><span class="content-vi">Ê-kíp</span><span class="content-en">Crew</span></h3>`;
            
            let crewHtml = `<div class="crew-scroller-container"><div class="crew-scroller">`;
            item.crewData.forEach(member => {
                crewHtml += `
                    <div class="crew-card">
                        <img 
                            src="${member.img}" 
                            data-full="${member.img}" 
                            data-name="${member.name}" 
                            data-role-vi="${member.role.vi}" 
                            data-role-en="${member.role.en}">
                        <div class="crew-info">
                            <div class="crew-role">
                                <span class="content-vi">${member.role.vi}</span>
                                <span class="content-en">${member.role.en}</span>
                            </div>
                            <div class="crew-name">${member.name}</div>
                        </div>
                    </div>
                `;
            });
            crewHtml += `</div></div>`;
            htmlContent += crewHtml;
        }

        // 3. Tự động sinh BTS Gallery Wall (nếu có) -> ĐÃ THÊM MỚI
        if (item.btsData && item.btsData.length > 0) {
            htmlContent += `
                <h3 style="margin-top: 50px;">
                    <span class="content-vi">Hậu trường</span>
                    <span class="content-en">Behind The Scene</span>
                </h3>
                <div class="gallery-wall">
            `;

            item.btsData.forEach(pic => {
                // Kiểm tra xem ảnh có class riêng (wide, tall, big) không
                const cssClass = pic.class ? ` class="${pic.class}"` : '';
                htmlContent += `<img src="${pic.src}"${cssClass} loading="lazy">`;
            });

            htmlContent += `</div>`;
        }

        section.innerHTML = htmlContent;
        contentContainer.appendChild(section);
    }

    // 4. HÀM XỬ LÝ URL
    function getIdFromUrl(path) {
        if (path.length > 1 && path.endsWith('/')) path = path.slice(0, -1);
        for (const [id, url] of Object.entries(urlMapping)) {
            if (url === path) return id;
        }
        
        const dynamicRoutes = [
            { prefix: '/short-films/',  idPrefix: 'short-films-' },
            { prefix: '/commercials/', idPrefix: 'commercials-' },
            { prefix: '/others/',      idPrefix: 'others-' },
            { prefix: '/writings/',    idPrefix: 'writings-' } 
        ];

        for (const route of dynamicRoutes) {
            if (path.startsWith(route.prefix)) {
                const slug = path.replace(route.prefix, '');
                return route.idPrefix + slug;
            }
        }
        return 'not-found';
    }

    // 5. HÀM SHOW PAGE (ĐÃ TỐI ƯU)
    // 5. HÀM SHOW PAGE (ĐÃ SỬA LỖI)
    // Thêm tham số doScroll = true vào dòng này để sửa lỗi ReferenceError
    function showPage(pageId, groupId = null, addToHistory = true, doScroll = true) {
        if (!pageId) pageId = 'home';

        // A. Tự động xác định Group
        if (!groupId) {
            if (pageId.startsWith('short-films-') || pageId === 'cat-short-films') groupId = 'group-short-films';
            else if (pageId.startsWith('commercials-') || pageId === 'cat-commercials') groupId = 'group-commercials';
            else if (pageId.startsWith('others-') || pageId === 'cat-others') groupId = 'group-others';
            else if (pageId.startsWith('writings-') || pageId === 'cat-writings') groupId = 'group-writings';
        }

        // B. Xử lý Writing (ĐÃ SỬA: Thêm phần Active Sidebar)
        if (pageId.startsWith('writings-')) {
            // 1. Mở trang chủ Writings để hiện layout, nhưng không cần cuộn
            showPage('cat-writings', 'group-writings', false, false); 
            
            // 2. Mở nội dung chi tiết bài viết
            setTimeout(() => openWritingDetail(pageId), 50);

            // 3. [FIX] Tự tay kích hoạt màu xanh cho Link bên Sidebar
            // Xóa active cũ của các link khác
            const allLinks = document.querySelectorAll('a');
            allLinks.forEach(l => l.classList.remove('active-link'));

            // Tìm link của bài viết hiện tại và tô xanh
            const specificLink = document.getElementById('link-' + pageId);
            if (specificLink) {
                specificLink.classList.add('active-link');
                
                // Đảm bảo menu con vẫn mở ra (nếu chưa mở)
                const group = document.getElementById('group-writings');
                if (group) group.classList.add('is-open');
            }

            // 4. Cập nhật lịch sử duyệt web
            if (addToHistory) {
                const slug = pageId.replace('writings-', '');
                updateHistory(pageId, 'group-writings', '/writings/' + slug);
            }
            return;
        }

        // C. RENDER DỮ LIỆU NẾU CHƯA CÓ
        renderSectionContent(pageId);

        // D. XỬ LÝ GIAO DIỆN CHUNG
        const sections = document.querySelectorAll('.page-section');
        sections.forEach(s => s.classList.remove('active-section'));
        
        const activeSection = document.getElementById(pageId);
        
        // --- ĐOẠN CODE XỬ LÝ CUỘN TRANG ---
        if (activeSection) {
            activeSection.classList.add('active-section');

            // Kiểm tra Mobile (<= 768px)
            if (window.innerWidth <= 768) {
                // Chỉ cuộn nếu doScroll là true (tức là người dùng bấm link)
                if (doScroll) {
                    setTimeout(() => {
                        activeSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                }
            } else {
                // Desktop: Luôn cuộn lên đầu
                window.scrollTo(0, 0);
            }
        } else {
            if (pageId !== 'not-found') console.warn("Không tìm thấy section:", pageId);
        }
        // -----------------------------------

        // Active Menu & Sidebar
        const allLinks = document.querySelectorAll('a');
        allLinks.forEach(l => l.classList.remove('active-link'));
        const activeLink = document.getElementById('link-' + pageId);
        if (activeLink) activeLink.classList.add('active-link');

        const allGroups = document.querySelectorAll('.category-group');
        allGroups.forEach(g => g.classList.remove('is-open'));
        if (groupId) {
            const g = document.getElementById(groupId);
            if (g) g.classList.add('is-open');
        }

        // E. Cập nhật History
        if (addToHistory) {
            let url = urlMapping[pageId];
            if (!url) {
                if (pageId.startsWith('short-films-')) url = '/short-films/' + pageId.replace('short-films-', '');
                else if (pageId.startsWith('commercials-')) url = '/commercials/' + pageId.replace('commercials-', '');
                else if (pageId.startsWith('others-')) url = '/others/' + pageId.replace('others-', '');
            }
            if (url) updateHistory(pageId, groupId, url);
        }

        // F. Fix Writing List Animation
        if (pageId === 'cat-writings' && typeof renderWritingList === 'function') {
            setTimeout(renderWritingList, 10);
        }
    }

    function updateHistory(pageId, groupId, url) {
        if (window.location.pathname !== url) {
            window.history.pushState({ pageId, groupId }, "", url);
        }
    }

    // 6. NHÀ MÁY SẢN XUẤT (CHỈ TẠO SIDEBAR & GRID - KHÔNG TẠO CHI TIẾT)
    function renderProjectSystem(dataObj, sidebarId, gridId, groupId) {
        const sidebar = document.getElementById(sidebarId);
        const grid = document.getElementById(gridId);
        
        if (!dataObj) return;

        for (const [id, item] of Object.entries(dataObj)) {
            // A. Sidebar Link
            if (sidebar) {
                const li = document.createElement('li');
                li.innerHTML = `
                    <a href="javascript:void(0)" onclick="showPage('${id}', '${groupId}')" id="link-${id}">
                        <span class="content-en">${item.title.en}</span>
                        <span class="content-vi">${item.title.vi}</span>
                    </a>
                `;
                sidebar.appendChild(li);
            }

            // B. Grid Thumbnail
            if (grid) {
                const a = document.createElement('a');
                a.href = "javascript:void(0)";
                a.onclick = () => showPage(id, groupId);
                a.className = "gallery-item";

                // [MỚI] Gắn thẻ tên để Google Sheet tìm thấy và ẩn đi
                a.id = 'thumb-' + id;
                
                // THÊM loading="lazy" vào thẻ img
                // Đây là cách tối ưu ảnh tốt nhất mà không cần giảm chất lượng
                a.innerHTML = `
                    <img src="${item.thumbnail || ''}" alt="${item.title.en}" loading="lazy">
                    <p style="margin-top: 5px; font-weight: bold;">
                        <span class="content-en">${item.title.en}</span>
                        <span class="content-vi">${item.title.vi}</span>
                    </p>
                `;
                grid.appendChild(a);
            }
            
            // LƯU Ý: Đã xóa phần tạo "Page Section" ở đây để tránh tải video ngầm
        }
    }

    // 7. KHỞI CHẠY
    document.addEventListener("DOMContentLoaded", () => {
        if (typeof filmsData !== 'undefined') renderProjectSystem(filmsData, 'sidebar-short-films-list', 'grid-short-films', 'group-short-films');
        if (typeof commercialData !== 'undefined') renderProjectSystem(commercialData, 'sidebar-commercials-list', 'grid-commercials', 'group-commercials');
        if (typeof othersData !== 'undefined') renderProjectSystem(othersData, 'sidebar-others-list', 'grid-others', 'group-others');

        if (typeof renderWritingList === 'function') {
            renderWritingList();   
            renderWritingSidebar(); 
        }

        const path = window.location.pathname;
        const initialId = getIdFromUrl(path);
        
        showPage(initialId, null, false, false);
    });

    window.onpopstate = function(event) {
        if (event.state) showPage(event.state.pageId, event.state.groupId, false);
        else showPage('home', null, false);
    };
</script>












<script>
    /* --- LOGIC: EXPLOSION + MUSIC HOME (AUTO STOP OTHERS) --- */
    document.addEventListener("DOMContentLoaded", () => {
        const homeSection = document.getElementById('home');
        const centerImage = document.querySelector('.home-center-img');
        
        const bgMusic = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3?v=2');
        bgMusic.loop = true; bgMusic.volume = 0.5;

        let hasChaosStarted = false;
        let resetTimer = null; 
        
        let isDragging = false;
        let currentDragItem = null;
        let dragOffsetX = 0;
        let dragOffsetY = 0;

        const wordsListEn = ["one", "Buddha", "is", "not", "enough"];
        const wordsListVi = ["một", "ông Bụt", "là", "không", "đủ"];
        const isMobile = window.innerWidth < 768;
        const WORD_COUNT = isMobile ? 50 : 120; 
        const MIN_SIZE = 7; const MAX_SIZE = 30;     

        function randomRange(min, max) { return Math.random() * (max - min) + min; }

        function startFloating(element) {
            const animations = element.getAnimations();
            animations.forEach(anim => anim.cancel());
            element.animate([
                { transform: `translate(-50%, -50%) rotate(0deg)` },
                { transform: `translate(calc(-50% + ${randomRange(-50,50)}px), calc(-50% + ${randomRange(-50,50)}px)) rotate(${randomRange(-90,90)}deg)` },
                { transform: `translate(-50%, -50%) rotate(0deg)` }
            ], { duration: randomRange(10000, 30000), iterations: Infinity, direction: 'alternate', easing: 'ease-in-out' });
        }

        // --- HÀM STOP CÔNG KHAI CHO CÁC TRANG KHÁC GỌI ---
        window.stopHomeMusic = function() {
            if (hasChaosStarted) resetChaos();
        };

        function createExplosion() {
            // TẮT NHẠC Ở 2 NƠI KHÁC TRƯỚC KHI CHẠY
            if (window.stopContactMusic) window.stopContactMusic();
            if (window.stopWritingMusic) window.stopWritingMusic();

            hasChaosStarted = true; 
            if (resetTimer) clearTimeout(resetTimer);
            bgMusic.play().catch(e => console.log("Lỗi:", e));
            
            homeSection.classList.add('music-on'); 

            const isVietnamese = document.body.classList.contains('mode-vi');
            const currentList = isVietnamese ? wordsListVi : wordsListEn;
            for (let i = 0; i < WORD_COUNT; i++) {
                const span = document.createElement('span');
                span.innerText = currentList[Math.floor(Math.random() * currentList.length)];
                span.className = 'chaos-word';
                span.style.pointerEvents = 'auto'; 
                span.style.cursor = 'grab';
                
                const size = randomRange(MIN_SIZE, MAX_SIZE);
                span.style.fontSize = `${size}px`;
                span.style.opacity = randomRange(0.2, 0.8);
                span.style.left = '50%'; span.style.top = '50%';
                span.style.transform = 'translate(-50%, -50%)'; 
                
                const flyDuration = randomRange(4.0, 8.0); 
                homeSection.appendChild(span);
                
                requestAnimationFrame(() => {
                    span.style.transition = `left ${flyDuration}s cubic-bezier(0.165, 0.84, 0.44, 1), top ${flyDuration}s cubic-bezier(0.165, 0.84, 0.44, 1), opacity ${flyDuration}s ease`;
                    const targetX = randomRange(-10, 110); const targetY = randomRange(-10, 110);
                    span.style.left = `${targetX}%`; span.style.top = `${targetY}%`;
                    setTimeout(() => { if (hasChaosStarted && currentDragItem !== span) startFloating(span); }, flyDuration * 1000);
                });
            }
        }

        function resetChaos() {
            hasChaosStarted = false; 
            homeSection.classList.remove('music-on');

            const words = document.querySelectorAll('.chaos-word');
            words.forEach(word => {
                const anims = word.getAnimations();
                anims.forEach(anim => anim.cancel());
                word.style.transition = "all 1.5s ease-in-out";
                word.style.left = '50%'; word.style.top = '50%'; word.style.opacity = '0'; 
            });
            resetTimer = setTimeout(() => {
                words.forEach(w => w.remove());
                bgMusic.pause(); 
            }, 1500);
        }

        function toggleChaos() { if (!hasChaosStarted) createExplosion(); else resetChaos(); }
        
        // --- DRAG & DROP LOGIC ---
        function getClientCoords(e) { 
            if (e.touches && e.touches.length > 0) return { x: e.touches[0].clientX, y: e.touches[0].clientY }; 
            return { x: e.clientX, y: e.clientY }; 
        }

        function onDragStart(e) { 
            if (e.target.classList.contains('chaos-word')) { 
                isDragging = true; 
                currentDragItem = e.target; 
                currentDragItem.style.cursor = 'grabbing'; 
                currentDragItem.style.transition = 'none'; 
                
                const anims = currentDragItem.getAnimations(); 
                anims.forEach(anim => anim.cancel()); 

                const rect = currentDragItem.getBoundingClientRect(); 
                const coords = getClientCoords(e); 
                dragOffsetX = coords.x - rect.left; 
                dragOffsetY = coords.y - rect.top; 

                if (e.cancelable && e.type === 'touchstart') e.preventDefault(); 
            } 
        }

        function onDragMove(e) { 
            if (isDragging && currentDragItem) { 
                if (e.cancelable) e.preventDefault(); 
                const containerRect = homeSection.getBoundingClientRect(); 
                const coords = getClientCoords(e); 
                const newLeft = coords.x - containerRect.left - dragOffsetX + (currentDragItem.offsetWidth / 2);
                const newTop = coords.y - containerRect.top - dragOffsetY + (currentDragItem.offsetHeight / 2);
                currentDragItem.style.left = `${newLeft}px`; 
                currentDragItem.style.top = `${newTop}px`; 
            } 
        }

        function onDragEnd() { 
            if (isDragging && currentDragItem) { 
                currentDragItem.style.cursor = 'grab'; 
                if (hasChaosStarted) startFloating(currentDragItem); 
                isDragging = false; 
                currentDragItem = null; 
            } 
        }

        document.addEventListener('mousedown', onDragStart); 
        document.addEventListener('mousemove', onDragMove); 
        document.addEventListener('mouseup', onDragEnd); 
        document.addEventListener('touchstart', onDragStart, { passive: false }); 
        document.addEventListener('touchmove', onDragMove, { passive: false }); 
        document.addEventListener('touchend', onDragEnd);

        const langSwitchBtn = document.querySelector('.lang-switch');
        if (langSwitchBtn) {
            langSwitchBtn.addEventListener('click', () => { 
                if (hasChaosStarted) {
                    const isVietnamese = document.body.classList.contains('mode-vi');
                    const currentList = isVietnamese ? wordsListVi : wordsListEn;
                    document.querySelectorAll('.chaos-word').forEach(w => w.innerText = currentList[Math.floor(Math.random() * currentList.length)]);
                }
            });
        }
        
        if (centerImage) {
            centerImage.style.cursor = 'pointer'; 
            centerImage.addEventListener('click', (e) => { e.stopPropagation(); toggleChaos(); });
            centerImage.addEventListener('touchstart', (e) => { e.stopPropagation(); e.preventDefault(); toggleChaos(); });
        }
    });
</script>








                
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const resumeLink = document.getElementById('wandering-resume');
        const aboutSection = document.getElementById('about');
        const resumeHolder = document.getElementById('resume-holder');
        
        let hasStarted = false; // Kiểm tra xem đã kích hoạt bay chưa
        let isHovering = false; 
        let moveTimer = null;   
        
        // Biến đếm số lần người dùng phải rượt đuổi
        let catchAttempt = 0; 
        const MAX_EVASION = 3; // Số lần nó bỏ chạy trước khi chịu đứng lại

        function random(min, max) {
            return Math.random() * (max - min) + min;
        }

        // Hàm tính toán vùng an toàn (Hành lang bên phải)
        function getNewCoordinates() {
            const containerW = aboutSection.offsetWidth;
            const containerH = aboutSection.offsetHeight;
            const itemW = resumeLink.offsetWidth;
            const itemH = resumeLink.offsetHeight;

            // Vùng an toàn: Nửa bên phải màn hình
            const safeZoneX = containerW * 0.40; 
            const minLeft = safeZoneX;
            const maxLeft = containerW - itemW - 20;

            const minTop = 80; // Tránh tiêu đề
            const maxTop = containerH - itemH - 20;

            // Fallback nếu màn hình quá nhỏ
            if (maxLeft < minLeft) return { left: containerW - itemW - 10, top: random(minTop, maxTop) };

            return {
                left: random(minLeft, maxLeft),
                top: random(minTop, maxTop)
            };
        }

        // HÀM 1: Di chuyển lơ lửng (Chậm)
        function moveResume() {
            if (!hasStarted) return; // Chưa bắt đầu thì không chạy
            
            // Nếu đang hover (đã bắt được) hoặc không ở tab About thì dừng
            if (isHovering || !aboutSection.classList.contains('active-section')) {
                moveTimer = setTimeout(moveResume, 1000);
                return;
            }

            // Xóa class bỏ chạy (nếu có) để trở về bay lơ lửng
            resumeLink.classList.remove('evading');

            const coords = getNewCoordinates();
            resumeLink.style.left = `${coords.left}px`;
            resumeLink.style.top = `${coords.top}px`;

            moveTimer = setTimeout(moveResume, 1300); // Tốc độ lơ lửng
        }

        // HÀM 2: Bỏ chạy (Nhanh)
        function evadeMouse() {
            // Thêm class evading để transition nhanh hơn (0.2s)
            resumeLink.classList.add('evading');
            
            const coords = getNewCoordinates();
            resumeLink.style.left = `${coords.left}px`;
            resumeLink.style.top = `${coords.top}px`;

            // Reset trạng thái hover để nó tiếp tục bay sau khi né
            isHovering = false;
            
            // Sau khi né xong (0.3s) thì quay lại chế độ bay lơ lửng
            setTimeout(() => {
                if (!isHovering) moveResume();
            }, 300);
        }

        // --- SỰ KIỆN TƯƠNG TÁC ---

        resumeLink.addEventListener('mouseenter', () => {
            // TRƯỜNG HỢP 1: Lần đầu tiên chạm vào -> KÍCH HOẠT GAME
            if (!hasStarted) {
                hasStarted = true;
                
                // Tính toán vị trí hiện tại so với khung cha để gán absolute không bị giật
                const rect = resumeLink.getBoundingClientRect();
                const parentRect = aboutSection.getBoundingClientRect();
                
                const startLeft = rect.left - parentRect.left;
                const startTop = rect.top - parentRect.top;

                // Chuyển sang Absolute
                resumeLink.style.left = `${startLeft}px`;
                resumeLink.style.top = `${startTop}px`;
                resumeLink.classList.add('flying');

                // Ngay lập tức bỏ chạy lần đầu tiên!
                catchAttempt++;
                evadeMouse();
                return;
            }

            // TRƯỜNG HỢP 2: Đã bay rồi -> XỬ LÝ RƯỢT ĐUỔI
            if (catchAttempt < MAX_EVASION) {
                catchAttempt++;
                // Bỏ chạy tiếp
                evadeMouse();
            } else {
                // TRƯỜNG HỢP 3: Đã đuổi đủ số lần -> ĐẦU HÀNG (Đứng yên)
                isHovering = true;
                clearTimeout(moveTimer);
                
                const computedStyle = window.getComputedStyle(resumeLink);
                resumeLink.style.transition = 'none'; // Freeze
                resumeLink.style.left = computedStyle.left;
                resumeLink.style.top = computedStyle.top;
            }
        });

        resumeLink.addEventListener('mouseleave', () => {
            // Nếu đã bắt được rồi mà thả ra thì reset lại game (hoặc cho bay tiếp tùy ý)
            // Ở đây mình cho nó bay tiếp lơ lửng
            if (hasStarted && isHovering) {
                isHovering = false;
                
                // Trả lại transition mượt
                resumeLink.style.transition = 'top 1.3s ease-in-out, left 1.3s ease-in-out, color 0.2s';
                moveResume();
                
                // MẸO: Reset lại số lần bắt để lần sau vào lại phải đuổi tiếp?
                // Nếu muốn khó thì uncomment dòng dưới:
                // catchAttempt = 0; 
            }
        });
    });
</script>


                
<script>
    // Hàm thiết lập ngôn ngữ
    function setLanguage(lang) {
        // 1. Gán class cho body (mode-en hoặc mode-vi)
        document.body.className = 'mode-' + lang;

        // 2. Đổi màu nút bấm (đậm nhạt)
        const btnEn = document.getElementById('btn-en');
        const btnVi = document.getElementById('btn-vi');

        if (lang === 'en') {
            btnEn.classList.add('active');
            btnVi.classList.remove('active');
        } else {
            btnVi.classList.add('active');
            btnEn.classList.remove('active');
        }

        // 3. Lưu lại lựa chọn (để F5 không bị mất)
        localStorage.setItem('preferredLang', lang);
    }

    // Tự động chạy khi vừa vào web
    document.addEventListener("DOMContentLoaded", () => {
        // Kiểm tra xem trước đó khách chọn gì, nếu chưa chọn thì mặc định là 'en' (Tiếng Anh)
        const savedLang = localStorage.getItem('preferredLang') || 'en';
        setLanguage(savedLang);
    });
</script>












<script>
    /* --- LOGIC: CONTACT MUSIC PLAYER (AUTO STOP OTHERS) --- */
    document.addEventListener("DOMContentLoaded", () => {
        const musicalImage = document.getElementById('musical-image');
        const contactAudio = document.getElementById('contact-audio');
        const contactWrapper = document.querySelector('.contact-image-wrapper'); 

        // --- HÀM STOP CÔNG KHAI ---
        window.stopContactMusic = function() {
            if (contactAudio && !contactAudio.paused) {
                contactAudio.pause();
                if (contactWrapper) contactWrapper.classList.remove('music-on');
                if (musicalImage) musicalImage.style.opacity = "1";
            }
        };

        if (musicalImage && contactAudio && contactWrapper) {
            function toggleContactMusic() {
                if (contactAudio.paused) {
                    // TẮT NHẠC Ở 2 NƠI KHÁC
                    if (window.stopHomeMusic) window.stopHomeMusic();
                    if (window.stopWritingMusic) window.stopWritingMusic();

                    // --- BẬT ---
                    contactAudio.play();
                    contactWrapper.classList.add('music-on'); 
                    musicalImage.style.opacity = "0.8"; 
                } else {
                    // --- TẮT (PAUSE) ---
                    window.stopContactMusic(); // Gọi chính hàm stop của mình cho gọn
                }
            }

            musicalImage.addEventListener('click', (e) => {
                e.stopPropagation();
                toggleContactMusic();
            });
            musicalImage.addEventListener('touchstart', (e) => {
                e.stopPropagation(); e.preventDefault(); toggleContactMusic();
            });
        }
    });
</script>









<script src="/short-films-data.js?v=5.0"></script>
<script src="/commercials-data.js?v=5.0"></script>
<script src="/others-data.js?v=5.0"></script>
<script src="/writings-data.js?v=5.0"></script>


<div id="lightbox-overlay" class="lightbox-overlay" onclick="closeLightbox(event)">
    <span class="lightbox-close" onclick="closeLightbox(event)">&times;</span>
    
    <button id="lb-prev" class="lb-nav-btn" onclick="changeLbSlide(-1, event)">&#10094;</button>
    
    <div class="lb-content-wrapper">
        <img id="lightbox-img" src="" onclick="event.stopPropagation()"> 
        <div id="lb-caption" class="lb-caption">
            <h3 id="lb-name">Name</h3>
            <p id="lb-role">Role</p>
        </div>
    </div>

    <button id="lb-next" class="lb-nav-btn" onclick="changeLbSlide(1, event)">&#10095;</button>
</div>

<script>
    // --- BIẾN TOÀN CỤC CHO GALLERY ---
    let currentCrewArray = []; 
    let currentCrewIndex = 0;  

    // 1. Lắng nghe sự kiện click toàn trang
    document.addEventListener('click', function(e) {
        // A. Click vào Gallery Wall (Ảnh BTS thường) -> BÂY GIỜ SẼ CÓ NÚT NEXT/PREV
        if (e.target && e.target.closest('.gallery-wall img')) {
            const clickedImg = e.target;
            const container = clickedImg.closest('.gallery-wall');
            
            // 1. Gom tất cả ảnh trong nhóm Gallery Wall đó lại thành 1 danh sách
            const allImagesArray = Array.from(container.querySelectorAll('img'));

            // 2. Tạo mảng dữ liệu (BTS không có tên/vai trò nên để trống)
            currentCrewArray = allImagesArray.map(img => ({
                src: img.src, // Lấy src hiện tại
                name: "",     // Không có tên
                role: ""      // Không có vai trò
            }));

            // 3. Xác định vị trí ảnh đang bấm
            currentCrewIndex = allImagesArray.indexOf(clickedImg);

            // 4. Mở Lightbox bằng chế độ Slide (Crew) thay vì chế độ đơn
            openCrewLightbox();
        }
        
        // B. Click vào Crew Scroll Item
        if (e.target && e.target.closest('.crew-card img')) {
            const clickedImg = e.target;
            const container = clickedImg.closest('.crew-scroller');
            
            const allImagesNodeList = container.querySelectorAll('.crew-card img');
            const allImagesArray = Array.from(allImagesNodeList); 

            currentCrewArray = allImagesArray.map(img => ({
                src: img.dataset.full, 
                name: img.dataset.name,
                role: img.dataset.role
            }));

            currentCrewIndex = allImagesArray.indexOf(clickedImg);
            openCrewLightbox();
        }
    });

    const lightbox = document.getElementById('lightbox-overlay');
    const lightboxImg = document.getElementById('lightbox-img');
    const lbPrev = document.getElementById('lb-prev');
    const lbNext = document.getElementById('lb-next');
    const lbCaption = document.getElementById('lb-caption');
    const lbName = document.getElementById('lb-name');
    const lbRole = document.getElementById('lb-role');

    // --- HÀM KHÓA SCROLL BACKGROUND (QUAN TRỌNG) ---
    function lockBodyScroll() {
        document.body.style.overflow = 'hidden'; // Ẩn thanh cuộn
        document.body.style.touchAction = 'none'; // Chặn các thao tác chạm mặc định của trình duyệt
    }

    function unlockBodyScroll() {
        document.body.style.overflow = ''; 
        document.body.style.touchAction = '';
    }

    // --- CHẾ ĐỘ 1: ẢNH ĐƠN ---
    function openSimpleLightbox(src) {
        lightboxImg.src = src;
        lightbox.style.display = "flex";
        
        lockBodyScroll(); // Khóa cuộn nền
        
        lbPrev.style.display = 'none';
        lbNext.style.display = 'none';
        lbCaption.style.display = 'none';
        
        disableSwipe(); // Tắt vuốt ở chế độ đơn
    }

    // --- CHẾ ĐỘ 2: CREW GALLERY ---
    function openCrewLightbox() {
        lightbox.style.display = "flex";
        
        lockBodyScroll(); // Khóa cuộn nền
        
        lbPrev.style.display = 'block';
        lbNext.style.display = 'block';
        lbCaption.style.display = 'block';

        updateLbContent();
        enableSwipe(); // Bật vuốt
    }

    // --- CẬP NHẬT HÀM UPDATE ĐỂ ẨN CHÚ THÍCH KHI KHÔNG CÓ CHỮ (QUAN TRỌNG) ---
    function updateLbContent() {
        if (!currentCrewArray || currentCrewArray.length === 0) return;
        const item = currentCrewArray[currentCrewIndex];
        lightboxImg.src = item.src;
        
        // Cập nhật nội dung
        lbName.innerHTML = item.name; 
        lbRole.innerHTML = item.role;

        // --- THÊM LOGIC NÀY: Nếu không có tên thì ẩn khung Caption đi cho đẹp ---
        if (!item.name && !item.role) {
            lbCaption.style.display = 'none';
        } else {
            lbCaption.style.display = 'block';
        }
    }

    function changeLbSlide(step, e) {
        if (e) { e.stopPropagation(); e.preventDefault(); }

        if (!currentCrewArray || currentCrewArray.length === 0) return;

        // --- SỬA LẠI: Thêm logic cộng trừ Index ---
        currentCrewIndex += step;
        
        // Xử lý vòng lặp: Nếu quá cuối thì về đầu, nếu quá đầu thì về cuối
        if (currentCrewIndex >= currentCrewArray.length) currentCrewIndex = 0;
        if (currentCrewIndex < 0) currentCrewIndex = currentCrewArray.length - 1;

        // Sau khi tính toán xong Index mới, gọi hàm update để hiển thị
        updateLbContent();
    }

    function closeLightbox(e) {
        if (!e || e.target === lightbox || e.target.classList.contains('lightbox-close')) {
            lightbox.style.display = "none";
            unlockBodyScroll(); // Mở khóa cuộn nền
            lightboxImg.src = ""; 
        }
    }
    
    document.addEventListener('keydown', function(e) {
        if (lightbox.style.display === "flex" && lbNext.style.display === 'block') {
            if (e.key === "ArrowLeft") changeLbSlide(-1, e);
            if (e.key === "ArrowRight") changeLbSlide(1, e);
        }
        if (e.key === "Escape") closeLightbox(e);
    });

    /* =========================================================== */
    /* --- TÍNH NĂNG VUỐT (SWIPE) + CHẶN CUỘN NỀN --- */
    /* =========================================================== */
    
    let touchStartX = 0;
    let touchEndX = 0;
    let touchStartY = 0;

    function handleTouchStart(e) {
        touchStartX = e.changedTouches[0].screenX;
        touchStartY = e.changedTouches[0].screenY;
    }

    function handleTouchMove(e) {
        // Đây là hàm QUAN TRỌNG NHẤT để chặn nền bị trôi
        
        // 1. Nếu người dùng đang chạm vào phần Chữ (Caption) -> Cho phép cuộn (để đọc chữ dài)
        if (e.target.closest('.lb-caption')) {
            return; // Thoát ra, không chặn
        }

        // 2. Nếu chạm vào Ảnh hoặc Nền đen -> CHẶN TUYỆT ĐỐI
        // preventDefault() sẽ bảo trình duyệt: "Đừng cuộn trang web, để yên đấy!"
        if (e.cancelable) {
            e.preventDefault(); 
        }
    }

    function handleTouchEnd(e) {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipeGesture();
    }

    function handleSwipeGesture() {
        const SWIPE_THRESHOLD = 50; 
        if (touchStartX - touchEndX > SWIPE_THRESHOLD) {
            changeLbSlide(1); // Vuốt trái -> Next
        }
        if (touchEndX - touchStartX > SWIPE_THRESHOLD) {
            changeLbSlide(-1); // Vuốt phải -> Prev
        }
    }

    function enableSwipe() {
        // start và end dùng passive: true cho mượt
        lightbox.addEventListener('touchstart', handleTouchStart, {passive: true});
        lightbox.addEventListener('touchend', handleTouchEnd, {passive: true});
        
        // move BẮT BUỘC phải dùng passive: false để dùng được preventDefault (chặn cuộn)
        lightbox.addEventListener('touchmove', handleTouchMove, {passive: false});
    }

    function disableSwipe() {
        lightbox.removeEventListener('touchstart', handleTouchStart);
        lightbox.removeEventListener('touchend', handleTouchEnd);
        lightbox.removeEventListener('touchmove', handleTouchMove);
    }
</script>


<script>
    /* --- HỆ THỐNG VẬT LÝ: FIX LỖI TỤM GÓC --- */

    let animationFrameId; 
    const physicsItems = []; 

    function renderWritingList() {
        const container = document.getElementById('writings-list-container');
        if (!container || typeof writingData === 'undefined') return;

        // 1. Reset
        container.innerHTML = '';
        physicsItems.length = 0; 
        if (animationFrameId) cancelAnimationFrame(animationFrameId);






        
        // --- FIX QUAN TRỌNG: TÍNH TOÁN KÍCH THƯỚC AN TOÀN ---
        
        // Kiểm tra xem có đang ở trên mobile không (màn hình nhỏ hơn 768px)
        const isMobile = window.innerWidth < 768;
        
        // Nếu là mobile: Trừ đi rất ít (padding 20px) vì sidebar đã nằm ở trên đầu rồi
        // Nếu là desktop: Trừ đi 300px (sidebar) để chữ không bay đè lên sidebar
        const sidebarOffset = isMobile ? 20 : 300;

        // Tính chiều rộng an toàn
        const safeWidth = container.offsetWidth > 0 ? container.offsetWidth : (window.innerWidth - sidebarOffset);
        
        // Chiều cao an toàn
        const safeHeight = container.offsetHeight > 0 ? container.offsetHeight : window.innerHeight;


        // --- KHỞI TẠO VỊ TRÍ ---
        // Trừ thêm 50px - 100px để chữ không bị sát lề phải quá
        const startX = Math.random() * (safeWidth - 80); 
        const startY = Math.random() * (safeHeight - 50);





        // 2. Tạo phần tử
        writingData.forEach((item, index) => {
            const el = document.createElement('div');
            el.className = 'writings-scatter-item';

            // [MỚI] Gắn thẻ tên để Google Sheet tìm thấy và ẩn đi
            el.id = 'scatter-' + item.id;
            
            el.innerHTML = `
                <span class="content-vi">${item.title.vi}</span>
                <span class="content-en">${item.title.en}</span>
            `;
            
            el.onclick = () => openWritingDetail(item.id);

            // Style
            const fontSize = Math.floor(Math.random() * 2) + 12; // 12px - 13px
            el.style.fontSize = fontSize + 'px';
            el.style.position = 'absolute';
            el.style.whiteSpace = 'nowrap';
            el.style.userSelect = 'none';
            el.style.cursor = 'pointer';
            el.style.opacity = Math.max(0.6, 1 - (index * 0.03));

            container.appendChild(el);

            // --- KHỞI TẠO VỊ TRÍ (DÙNG KÍCH THƯỚC AN TOÀN) ---
            const startX = Math.random() * (safeWidth - 100); 
            const startY = Math.random() * (safeHeight - 50);

            // Random vận tốc
            const vx = (Math.random() - 0.5) * 0.4; 
            const vy = (Math.random() - 0.5) * 0.4;

            physicsItems.push({
                el: el,
                x: startX,
                y: startY,
                vx: vx,
                vy: vy,
                width: 0, 
                height: 0
            });
        });

        // Đo kích thước thật ngay sau khi append
        physicsItems.forEach(item => {
            item.width = item.el.offsetWidth;
            item.height = item.el.offsetHeight;
        });

        runPhysicsLoop(container);
    }

    function runPhysicsLoop(container) {
        function update() {
            // Cập nhật lại kích thước khung chứa liên tục (đề phòng resize)
            // Nếu đang ẩn thì vẫn giữ logic cũ, nếu hiện thì lấy kích thước thật
            const containerW = container.offsetWidth > 0 ? container.offsetWidth : window.innerWidth;
            const containerH = container.offsetHeight > 0 ? container.offsetHeight : window.innerHeight;

            physicsItems.forEach((itemA, i) => {
                // A. Di chuyển
                itemA.x += itemA.vx;
                itemA.y += itemA.vy;

                // B. Va chạm tường (Wall Bounce)
                if (itemA.x <= 0) {
                    itemA.x = 0;
                    itemA.vx *= -1;
                } else if (itemA.x + itemA.width >= containerW) {
                    itemA.x = containerW - itemA.width;
                    itemA.vx *= -1;
                }

                if (itemA.y <= 0) {
                    itemA.y = 0;
                    itemA.vy *= -1;
                } else if (itemA.y + itemA.height >= containerH) {
                    itemA.y = containerH - itemA.height;
                    itemA.vy *= -1;
                }

                // C. Va chạm với nhau (Object Collision)
                for (let j = i + 1; j < physicsItems.length; j++) {
                    const itemB = physicsItems[j];

                    if (isOverlapping(itemA, itemB)) {
                        // Tính toán vector đẩy
                        let dx = (itemA.x + itemA.width/2) - (itemB.x + itemB.width/2);
                        let dy = (itemA.y + itemA.height/2) - (itemB.y + itemB.height/2);

                        if (dx === 0) dx = Math.random() - 0.5;
                        if (dy === 0) dy = Math.random() - 0.5;

                        const distance = Math.sqrt(dx*dx + dy*dy);
                        const unitX = dx / distance;
                        const unitY = dy / distance;

                        const pushForce = 0.2; 

                        // Đẩy vận tốc
                        itemA.vx += unitX * pushForce;
                        itemA.vy += unitY * pushForce;
                        itemB.vx -= unitX * pushForce;
                        itemB.vy -= unitY * pushForce;
                        
                        // Tách vị trí ngay lập tức (quan trọng để không bị dính)
                        const separateSpeed = 1; // Tăng lên một chút để tách nhanh hơn
                        itemA.x += unitX * separateSpeed;
                        itemA.y += unitY * separateSpeed;
                        itemB.x -= unitX * separateSpeed;
                        itemB.y -= unitY * separateSpeed;
                    }
                }

                // D. Giới hạn tốc độ (Friction)
                const maxSpeed = 0.8; // Tăng nhẹ max speed để chúng nó linh hoạt hơn
                if (itemA.vx > maxSpeed) itemA.vx = maxSpeed;
                if (itemA.vx < -maxSpeed) itemA.vx = -maxSpeed;
                if (itemA.vy > maxSpeed) itemA.vy = maxSpeed;
                if (itemA.vy < -maxSpeed) itemA.vy = -maxSpeed;

                // E. Render
                itemA.el.style.left = itemA.x + 'px';
                itemA.el.style.top = itemA.y + 'px';
            });

            animationFrameId = requestAnimationFrame(update);
        }
        update();
    }

    // Hàm kiểm tra va chạm (+ padding 15px cho thoáng)
    function isOverlapping(a, b) {
        const padding = 15; 
        return (
            a.x < b.x + b.width + padding &&
            a.x + a.width + padding > b.x &&
            a.y < b.y + b.height + padding &&
            a.y + a.height + padding > b.y
        );
    }

    /* --- CÁC HÀM PHỤ TRỢ --- */
    function renderWritingSidebar() {
        const sidebarList = document.getElementById('sidebar-writings-list');
        if (!sidebarList || typeof writingData === 'undefined') return;
        sidebarList.innerHTML = ''; 
        writingData.forEach(item => {
            const li = document.createElement('li');
            li.innerHTML = `
                <a href="javascript:void(0)" onclick="showPage('${item.id}')" id="link-${item.id}">
                    <span class="content-vi">${item.title.vi}</span>
                    <span class="content-en">${item.title.en}</span>
                </a>
            `;
            sidebarList.appendChild(li);
        });
    }

    // --- HÀM MỞ BÀI VIẾT (CẬP NHẬT URL) ---
    function openWritingDetail(id) {
        const post = writingData.find(item => item.id === id);
        if (!post) return;

        // 1. Điền dữ liệu
        const titleEl = document.getElementById('detail-title');
        const metaEl = document.getElementById('detail-meta');
        const contentEl = document.getElementById('detail-content');
        const viewEl = document.getElementById('writings-detail-view');

        if (titleEl) titleEl.innerHTML = `<span class="content-vi">${post.title.vi}</span><span class="content-en">${post.title.en}</span>`;
        if (metaEl) metaEl.innerText = `${post.location}, ${post.date}`;
        if (contentEl) contentEl.innerHTML = `<div class="content-vi">${post.content.vi}</div><div class="content-en">${post.content.en}</div>`;

        // 2. Hiện khung bài viết
        if (viewEl) {
            viewEl.style.display = 'block';
            setTimeout(() => {
                viewEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // 3. [TỰ ĐỘNG HOÁ 100%] Tự tạo URL từ ID bài viết
        // Logic: Nếu ID là "writings-abc-xyz" -> Link sẽ là "/writings/abc-xyz"
        
        let newUrl = "";
        
        // Kiểm tra nếu có trong danh sách thủ công (urlMapping) thì ưu tiên dùng
        if (urlMapping[id]) {
            newUrl = urlMapping[id];
        } 
        // Nếu không có, tự động tạo ra từ ID
        else if (id.startsWith('writings-')) {
            const slug = id.replace('writings-', ''); // Cắt bỏ chữ "writings-" (6 ký tự đầu)
            newUrl = '/writings/' + slug;
        }

        // Tiến hành cập nhật URL nếu có thay đổi
        if (newUrl) {
            const currentPath = window.location.pathname;
            if (currentPath !== newUrl) {
                window.history.pushState({ pageId: id, groupId: 'group-writings' }, "", newUrl);
            }
        }
    }

    // --- HÀM ĐÓNG BÀI VIẾT (TRẢ VỀ URL GỐC) ---
    function closeWritingDetail() {
        const viewEl = document.getElementById('writings-detail-view');
        if (viewEl) {
            viewEl.style.display = 'none';
            const topArea = document.querySelector('.writings-top-area');
            if (topArea) topArea.scrollIntoView({ behavior: 'smooth' });
        }

        // Trả URL về /writings
        window.history.pushState({ pageId: 'cat-writings', groupId: 'group-writings' }, "", '/writings');
    }

    // Bắt sự kiện Resize để không bị lỗi văng ra ngoài
    window.addEventListener('resize', () => {
        const container = document.getElementById('writings-list-container');
        // Reset lại nếu cần thiết, hoặc để physics tự xử lý
    });

    document.addEventListener("DOMContentLoaded", () => {
        renderWritingList();   
        renderWritingSidebar(); 
    });
</script>












<script>
    /* --- WRITING MUSIC PLAYER: HARUKA NAKAMURA (AUTO STOP OTHERS) --- */
    
    // ... (GIỮ NGUYÊN KHAI BÁO BIẾN vÀ LIST NHẠC Ở TRÊN, CHỈ SỬA CÁC HÀM DƯỚI ĐÂY) ...
    // ĐỂ TIỆN, BẠN CÓ THỂ COPY ĐÈ TOÀN BỘ SCRIPT NÀY VÀO:

    const writingPlaylist = [
        { title: "better day", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/1_betterday_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "one light", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/2_onelight_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "morning", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/3_morning_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "fragile", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/4_fragile_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "your sonnet", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/5_yoursonnet_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "fly", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/6_Fly_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "call from spring", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/7_callfromspring_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "easel", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/8_easel_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "sometime", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/9_sometime_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "seasons when a wind passes by", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/10_seasonswhenawindpassesby_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "rainy day", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/11_rainyday_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "anthology", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/12_anthology_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "call me", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/13_callme_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "17:00", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/14_1700_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" },
        { title: "foresight light", src: "https://cdn.jsdelivr.net/gh/phamhuutri108/portfolio-phamhuutri@main/assets/writings/still-life/15_foresightlight_still_life_haruka_nakamura.mp3?v=2", duration: "--:--" }
    ];

    let wpIsActive = false;
    let wpIsPlaying = false;
    let wpIsExpanded = false;
    let wpCurrentIndex = 0;

    const wpTitleEl = document.getElementById('writing-main-title');
    const wpHintEl = document.getElementById('writing-hint');
    const wpPanelEl = document.getElementById('writing-player');
    const wpAudio = document.getElementById('writing-audio-source');
    
    const displayWpTitle = document.getElementById('wp-song-title');
    const displayWpTime = document.getElementById('wp-artist-name'); 
    const wpPlayBtn = document.getElementById('wp-play-btn');
    const wpPlaylistContainer = document.getElementById('wp-playlist');

    const iconWpPlay = '<svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>';
    const iconWpPause = '<svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';

    function formatTime(seconds) {
        if (isNaN(seconds) || seconds < 0) return "--:--";
        const m = Math.floor(seconds / 60);
        const s = Math.floor(seconds % 60);
        return `${m < 10 ? '0' + m : m}:${s < 10 ? '0' + s : s}`;
    }

    function preloadDurations() {
        writingPlaylist.forEach((item, index) => {
            const tempAudio = new Audio(item.src);
            tempAudio.addEventListener('loadedmetadata', () => {
                item.realDuration = tempAudio.duration;
                updatePlaylistItemDuration(index, tempAudio.duration);
            });
        });
    }

    function updatePlaylistItemDuration(index, duration) {
        const items = document.querySelectorAll('.wp-playlist-item');
        if (items[index]) {
            const timeSpan = items[index].querySelector('span:last-child');
            if (timeSpan && index !== wpCurrentIndex) {
                timeSpan.innerText = formatTime(duration);
            }
        }
    }

    // --- HÀM STOP CÔNG KHAI ---
    window.stopWritingMusic = function() {
        if (wpIsPlaying) {
            wpAudio.pause();
            wpIsPlaying = false;
            updateWpPlayIcon();
        }
    }

    function toggleWritingMusic() {
        wpIsActive = !wpIsActive;
        const hintEn = wpHintEl.querySelector('.content-en');
        const hintVi = wpHintEl.querySelector('.content-vi');

        if (wpIsActive) {
            // TẮT NHẠC NƠI KHÁC KHI MỞ PLAYER
            if (window.stopHomeMusic) window.stopHomeMusic();
            if (window.stopContactMusic) window.stopContactMusic();

            wpTitleEl.classList.add('music-active'); 
            if(hintEn) hintEn.innerText = "Click to close";
            if(hintVi) hintVi.innerText = "Bấm để đóng";
            wpPanelEl.classList.add('visible');
            displayWpTitle.innerText = "Still Life - Haruka Nakamura"; 
            loadWpSong(wpCurrentIndex);
        } else {
            wpTitleEl.classList.remove('music-active');
            if(hintEn) hintEn.innerText = "Click to open";
            if(hintVi) hintVi.innerText = "Bấm để mở";
            wpPanelEl.classList.remove('visible');
            wpPanelEl.classList.remove('expanded');
            wpIsExpanded = false;
            
            wpAudio.pause();
            wpIsPlaying = false;
            updateWpPlayIcon();
        }
    }

    function wpToggleExpand() {
        if (!wpIsActive) return;
        wpIsExpanded = !wpIsExpanded;
        if (wpIsExpanded) wpPanelEl.classList.add('expanded');
        else wpPanelEl.classList.remove('expanded');
    }

    function loadWpSong(index) {
        if (index < 0 || index >= writingPlaylist.length) return;
        const song = writingPlaylist[index];
        displayWpTitle.innerText = "Still Life - Haruka Nakamura"; 
        displayWpTime.innerText = "Loading..."; 
        wpAudio.src = song.src;
        wpAudio.load(); 
        renderWpPlaylist(); 
    }

    wpAudio.addEventListener('loadedmetadata', () => {
        const totalDuration = wpAudio.duration;
        writingPlaylist[wpCurrentIndex].realDuration = totalDuration; 
        if (!wpIsPlaying) {
            displayWpTime.innerText = formatTime(totalDuration);
        }
        renderWpPlaylist();
    });

    wpAudio.addEventListener('timeupdate', () => {
        if (wpAudio.duration) {
            const remaining = wpAudio.duration - wpAudio.currentTime;
            const formattedTime = "-" + formatTime(remaining);
            displayWpTime.innerText = formattedTime;
            const activeTimeEl = document.getElementById('wp-active-time-display');
            if (activeTimeEl) {
                activeTimeEl.innerText = formattedTime;
                activeTimeEl.style.fontVariantNumeric = "tabular-nums"; 
            }
        }
    });

    wpAudio.addEventListener('ended', () => {
        wpNext();
    });

    function renderWpPlaylist() {
        wpPlaylistContainer.innerHTML = '';
        writingPlaylist.forEach((song, index) => {
            const div = document.createElement('div');
            div.className = 'wp-playlist-item';
            let timeDisplay = "";
            if (index === wpCurrentIndex) {
                div.classList.add('active');
                timeDisplay = `<span id="wp-active-time-display">--:--</span>`;
            } else {
                const durationToShow = song.realDuration ? formatTime(song.realDuration) : song.duration;
                timeDisplay = `<span>${durationToShow}</span>`;
            }
            div.innerHTML = `<span>${index + 1}. ${song.title}</span> ${timeDisplay}`;
            
            div.onclick = () => {
                // TẮT NHẠC NƠI KHÁC KHI CHỌN BÀI
                if (window.stopHomeMusic) window.stopHomeMusic();
                if (window.stopContactMusic) window.stopContactMusic();

                wpCurrentIndex = index;
                loadWpSong(wpCurrentIndex);
                setTimeout(() => {
                    wpIsPlaying = true;
                    wpAudio.play().catch(e => console.log(e));
                    updateWpPlayIcon();
                }, 50);
            };
            wpPlaylistContainer.appendChild(div);
        });
    }

    function wpTogglePlay() {
        if (wpIsPlaying) {
            wpAudio.pause();
            wpIsPlaying = false;
        } else {
            // TẮT NHẠC NƠI KHÁC KHI BẤM PLAY
            if (window.stopHomeMusic) window.stopHomeMusic();
            if (window.stopContactMusic) window.stopContactMusic();

            wpAudio.play();
            wpIsPlaying = true;
        }
        updateWpPlayIcon();
    }

    function updateWpPlayIcon() {
        wpPlayBtn.innerHTML = wpIsPlaying ? iconWpPause : iconWpPlay;
    }

    function wpNext() {
        wpCurrentIndex = (wpCurrentIndex + 1) % writingPlaylist.length;
        loadWpSong(wpCurrentIndex);
        setTimeout(() => { wpIsPlaying = true; wpAudio.play(); updateWpPlayIcon(); }, 50);
    }

    function wpPrev() {
        wpCurrentIndex = (wpCurrentIndex - 1 + writingPlaylist.length) % writingPlaylist.length;
        loadWpSong(wpCurrentIndex);
        setTimeout(() => { wpIsPlaying = true; wpAudio.play(); updateWpPlayIcon(); }, 50);
    }

    document.addEventListener("DOMContentLoaded", () => {
        setTimeout(preloadDurations, 2000);
    });
</script>












<script>
    // --- LOGIC CHỈNH CỠ CHỮ (FINAL) ---

    // 1. Hàm Toggle Menu Mobile (Gắn vào nút AA)
    function toggleMobileMenu() {
        const tools = document.getElementById('mobile-text-tools');
        tools.classList.toggle('is-open');
    }

    // 2. Hàm Tăng/Giảm (Gắn vào nút + / - và nút Desktop)
    let currentFontSize = 16;
    
    function adjustWritingSize(amount) {
        const contentEl = document.getElementById('detail-content');
        if (!contentEl) return;

        currentFontSize += amount;
        
        // Giới hạn
        if (currentFontSize < 12) currentFontSize = 12;
        if (currentFontSize > 26) currentFontSize = 26;

        contentEl.style.fontSize = currentFontSize + "px";
        contentEl.style.lineHeight = (1.6 + (amount * 0.05)) + "";
        
        // QUAN TRỌNG: KHÔNG ĐÓNG MENU Ở ĐÂY
        // Để người dùng có thể bấm liên tiếp nhiều lần
    }

    // 3. Logic tự đóng khi cuộn trang (Chỉ cho Mobile)
    document.addEventListener("DOMContentLoaded", () => {
        const writingContainer = document.getElementById('writings-detail-view'); // Vùng cuộn
        let scrollTimeout;

        if (writingContainer) {
            // Lắng nghe sự kiện cuộn trên toàn bộ cửa sổ (Window) vì trên mobile body cuộn
            window.addEventListener('scroll', function() {
                const tools = document.getElementById('mobile-text-tools');
                
                // Chỉ chạy logic nếu menu đang mở
                if (tools && tools.classList.contains('is-open')) {
                    clearTimeout(scrollTimeout);
                    
                    // Nếu người dùng cuộn, chờ 100ms rồi đóng lại
                    scrollTimeout = setTimeout(() => {
                         tools.classList.remove('is-open');
                    }, 100);
                }
            }, { passive: true });
        }
    });
</script>







<script>

    /* --- NGĂN CHẶN TẢI ẢNH/VIDEO/VIEW SOURCE --- */


    document.addEventListener('DOMContentLoaded', () => {
        // 1. Chặn menu chuột phải (Context Menu)
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
        });

        // 2. Chặn kéo thả bất cứ thứ gì (Ảnh/Text)
        document.addEventListener('dragstart', (e) => {
            e.preventDefault();
        });

        // 3. Chặn các phím tắt (Ctrl+C, Ctrl+S, Ctrl+U, F12...)
        document.addEventListener('keydown', (e) => {
            // Chặn F12
            if (e.key === 'F12') {
                e.preventDefault();
                return;
            }

            // Chặn Ctrl+Shift+I (DevTools)
            if (e.ctrlKey && e.shiftKey && e.key === 'I') {
                e.preventDefault();
                return;
            }

            // Chặn Ctrl+C (Copy), Ctrl+S (Save), Ctrl+U (View Source), Ctrl+P (Print)
            if (e.ctrlKey && (e.key === 'c' || e.key === 's' || e.key === 'u' || e.key === 'p')) {
                e.preventDefault();
                return;
            }
        });
    });
</script>










<script>
    document.addEventListener("DOMContentLoaded", () => {
        // --- CẤU HÌNH ---
        // Link Apps Script của bạn (Đã điền sẵn)
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwhHX8zkSAu5CigMgY4MWn_ifa5f0J8p5V7fgDxHFkUE9EKd8P3TyEuthivR5UwPBOB/exec";

        console.log("Đang tải dữ liệu Real-time...");

        fetch(APPS_SCRIPT_URL)
            .then(response => response.text())
            .then(csvText => {
                const rows = csvText.split('\n');
                
                rows.forEach(row => {
                    const cols = row.split(',');
                    if (cols.length < 2) return;

                    const targetId = cols[0].trim(); 
                    const status = cols[1].trim().toUpperCase(); 

                    // Nếu lệnh là OFF -> Ẩn ngay lập tức
                    if (status === 'OFF') {
                        // 1. Ẩn chính nó (Nếu là ID nhóm)
                        const element = document.getElementById(targetId);
                        if (element) element.style.display = 'none';

                        // 2. Ẩn Link trên Sidebar
                        const sidebarLink = document.getElementById(`link-${targetId}`);
                        if (sidebarLink) {
                            if(sidebarLink.parentElement.tagName === 'LI') {
                                sidebarLink.parentElement.style.display = 'none';
                            } else {
                                sidebarLink.style.display = 'none';
                            }
                        }

                        // 3. Ẩn Ảnh Thumbnail
                        const thumbItem = document.getElementById(`thumb-${targetId}`);
                        if (thumbItem) thumbItem.style.display = 'none';

                        // 4. Ẩn Chữ bay
                        const scatterItem = document.getElementById(`scatter-${targetId}`);
                        if (scatterItem) scatterItem.style.display = 'none';
                    }
                });
            })
            .catch(error => console.error("Lỗi:", error));
    });
</script>










<script>
    /* ============================================================= */
    /* --- HỆ THỐNG XỬ LÝ CREW: FIX LỖI NHẢY & QUÁ NHẠY MOBILE --- */
    /* ============================================================= */
    
    function initCrewSystem() {
        const sliders = document.querySelectorAll('.crew-scroller');

        sliders.forEach(slider => {
            if (slider.dataset.init === "true") return;
            slider.dataset.init = "true";

            const cards = Array.from(slider.querySelectorAll('.crew-card'));
            
            // Biến kiểm tra kéo/click
            let isDragging = false;
            let startDragX = 0;

            // --- 1. HÀM TÌM THẺ GIỮA (VISUAL ONLY) ---
            const updateActiveState = () => {
                const centerPoint = slider.scrollLeft + (slider.offsetWidth / 2);
                let closest = null;
                let minDistance = Infinity;

                // Dùng vòng lặp tối ưu để tìm thẻ gần tâm nhất
                for (let i = 0; i < cards.length; i++) {
                    const card = cards[i];
                    const cardCenter = card.offsetLeft + (card.offsetWidth / 2);
                    const distance = Math.abs(centerPoint - cardCenter);
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        closest = card;
                    }
                }

                // Cập nhật class active (chỉ thay đổi khi cần thiết để đỡ giật)
                cards.forEach(card => {
                    if (card === closest) {
                        if (!card.classList.contains('active')) card.classList.add('active');
                    } else {
                        if (card.classList.contains('active')) card.classList.remove('active');
                    }
                });
            };

            // --- 2. LẮNG NGHE SỰ KIỆN CUỘN (TỐI ƯU HÓA) ---
            // Thay vì setTimeout, ta dùng requestAnimationFrame để mượt theo màn hình
            let ticking = false;
            
            slider.addEventListener('scroll', () => {
                if (!ticking) {
                    window.requestAnimationFrame(() => {
                        updateActiveState();
                        ticking = false;
                    });
                    ticking = true;
                }
            }, { passive: true });

            // --- 3. LOGIC CLICK THÔNG MINH ---
            cards.forEach(card => {
                card.addEventListener('click', (e) => {
                    if (isDragging) {
                        e.preventDefault(); e.stopPropagation(); return; 
                    }

                    if (!card.classList.contains('active')) {
                        e.preventDefault(); e.stopPropagation(); 
                        // Cuộn mượt khi click (JS scroll vẫn cần smooth)
                        card.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                    } 
                    else {
                        const img = card.querySelector('img');
                        openCrewLightboxFromElement(img, slider);
                    }
                });
            });

            // --- 4. HỖ TRỢ KÉO THẢ (DRAG) TRÊN DESKTOP ---
            // (Đã chặn xung đột với Touch của mobile)
            let isDown = false;
            let startX;
            let scrollLeft;

            slider.addEventListener('mousedown', (e) => {
                isDown = true;
                isDragging = false;
                startDragX = e.pageX;
                slider.classList.add('active');
                startX = e.pageX - slider.offsetLeft;
                scrollLeft = slider.scrollLeft;
                
                // Khi bắt đầu kéo bằng chuột, tắt snap để không bị khựng
                slider.style.scrollSnapType = 'none'; 
                slider.style.scrollBehavior = 'auto';
            });

            const stopDragging = () => {
                if (!isDown) return;
                isDown = false;
                slider.classList.remove('active');
                
                // Bật lại snap khi thả chuột ra
                slider.style.scrollSnapType = 'x mandatory'; 
                // Delay reset cờ drag để tránh click nhầm
                setTimeout(() => { isDragging = false; }, 50); 
            };

            slider.addEventListener('mouseleave', stopDragging);
            slider.addEventListener('mouseup', stopDragging);

            slider.addEventListener('mousemove', (e) => {
                if (!isDown) return;
                e.preventDefault();
                
                if (Math.abs(e.pageX - startDragX) > 5) isDragging = true; 

                const x = e.pageX - slider.offsetLeft;
                const walk = (x - startX) * 2; 
                slider.scrollLeft = scrollLeft - walk;
            });

            // Chạy lần đầu
            updateActiveState();
        });
    }

    // --- HELPER MỞ LIGHTBOX (Thêm hàm này để nối với logic cũ) ---
    function openCrewLightboxFromElement(clickedImg, container) {
        // Lấy danh sách ảnh trong slider hiện tại
        const allImages = Array.from(container.querySelectorAll('.crew-card img'));
        
        currentCrewArray = allImages.map(img => ({
            src: img.dataset.full, 
            name: img.dataset.name,
            // Xử lý role song ngữ
            role: document.body.classList.contains('mode-vi') 
                  ? img.dataset.roleVi 
                  : img.dataset.roleEn 
        }));

        currentCrewIndex = allImages.indexOf(clickedImg);
        
        // Gọi hàm mở lightbox có sẵn của bạn
        openCrewLightbox(); 
    }

    // Tự động chạy khi có thay đổi DOM (MutationObserver)
    const observer = new MutationObserver((mutations) => {
        if (document.querySelector('.crew-scroller:not([data-init="true"])')) {
            initCrewSystem();
        }
    });
    observer.observe(document.body, { childList: true, subtree: true });

    document.addEventListener("DOMContentLoaded", initCrewSystem);
    window.addEventListener('resize', () => {
        const sliders = document.querySelectorAll('.crew-scroller');
        sliders.forEach(slider => slider.dispatchEvent(new Event('scroll')));
    });
</script>














</body>
</html>